<h1 id="dataknead">dataknead</h1><p><strong>Effortless conversion between data formats like JSON, XML and CSV</strong></p><p><a href="https://github.com/hay/dataknead"><strong>Source on Github</strong></a></p><p><strong>dataknead</strong> is a fluid Python library and command line utility for processing and converting between common data formats like JSON and CSV.</p><p>Have you ever sighed when writing code like this?</p><pre><code class="language-python">import csv
import json

with open(&quot;names.json&quot;) as f:
    data = json.loads(f.read())

data = [row[&quot;name&quot;] for row in data if &quot;John&quot; in row[&quot;name&quot;]]

with open(&quot;names.csv&quot;, &quot;w&quot;) as f:
    writer = csv.writer(f)
    writer.writerow([&quot;name&quot;])
    [writer.writerow([row]) for row in data]</code></pre><p>Now you can write it like this:</p><pre><code class="language-python">from dataknead import Knead
Knead(&quot;names.json&quot;).filter(lambda r:&quot;John&quot; in r[&quot;name&quot;]).write(&quot;names.csv&quot;)</code></pre><p>Or what about simply converting <code>json</code> to <code>csv</code>? With <code>dataknead</code> you get the <code>knead</code> command line utility which makes things easy:</p><pre><code class="language-bash">knead names.json names.csv</code></pre><p><code>dataknead</code> has inbuilt loaders for CSV, Excel, JSON and XML and you can easily write your own.</p><h2 id="installation">Installation</h2><p>Install <code>dataknead</code> from <a href="https://pypi.python.org/pypi/dataknead">PyPi</a></p><pre><code class="language-shell">pip install dataknead</code></pre><p>Then import</p><pre><code class="language-python">from dataknead import Knead</code></pre><h2 id="basic-example-and-tutorial">Basic example and tutorial</h2><p>Let&#39;s say you have a small CSV file with cities and their population called <code>cities.csv</code>.</p><pre><code class="language-csv">city,country,population
Amsterdam,nl,850000
Rotterdam,nl,635000
Venice,it,265000</code></pre><p>And you want to load this csv file and transform it to a json file.</p><pre><code class="language-python">from dataknead import Knead

Knead(&quot;cities.csv&quot;).write(&quot;cities.json&quot;)</code></pre><p>You&#39;ll now have a json file called <code>cities.json</code> that looks like this:</p><pre><code class="language-json">[
    {
        &quot;city&quot; : &quot;Amsterdam&quot;,
        &quot;country&quot; : &quot;nl&quot;,
        &quot;population&quot; : 850000
    },
    ...
]</code></pre><p>Maybe you just want the city names and write them to a CSV filed called <code>city-names.csv</code>.</p><pre><code class="language-python">from dataknead import Knead

Knead(&quot;cities.csv&quot;).map(&quot;city&quot;).write(&quot;city-names.csv&quot;)</code></pre><p>That will give you this list</p><pre><code class="language-csv">Amsterdam
Rotterdam
Venice</code></pre><p>Now you want to extract only the cities that are located in Italy, and write that back to a new csv file called <code>cities-italy.csv</code>:</p><pre><code class="language-python">from dataknead import Knead

Knead(&quot;cities.csv&quot;).filter(lambda r:r[&quot;country&quot;] == &quot;it&quot;).write(&quot;cities-italy.csv&quot;)</code></pre><p>This gives you this:</p><pre><code class="language-csv">city,country,population
Venice,it,265000</code></pre><p>Nice huh?</p><h2 id="advanced-example">Advanced example</h2><p>Check out <a href="https://github.com/hay/dataknead/blob/master/tests/advanced_example.py">the advanced example</a>. This also shows you how to do more complex data manipulation using external libraries like <a href="https://stedolan.github.io/jq/">jq</a>.</p><h2 id="philosophy">Philosophy</h2><p><code>dataknead</code> is intended for easy conversion between common data formats and basic manipulation. It&#39;s not a replacement for more complex libraries like <code>pandas</code> or <code>numpy</code>, but instead can be a useful addition to those libraries.</p><p>The API is as minimal as possible and <a href="https://en.wikipedia.org/wiki/Fluent_interface">fluent</a>.</p><p>I try to use as many existing and well-tested libraries as possible. For example, the XML loader uses the excellent <a href="https://github.com/martinblech/xmltodict"><code>xmltodict</code></a> module.</p><h2 id="command-line-utility-knead">Command line utility (<code>knead</code>)</h2><p><code>dataknead</code> includes the <code>knead</code> command line utility you can use for simple conversion of data formats.</p><pre><code>knead cities.csv cities.json</code></pre><p>Will transform a filed called <code>cities.csv</code> to a file called <code>cities.json</code> and is equivalent to this piece of Python code</p><pre><code>Knead(&quot;cities.csv&quot;).write(&quot;cities.json&quot;)</code></pre><p><code>knead</code> can also be used as a quick way of viewing the contents of a file, just give it an input file</p><pre><code>knead cities.csv</code></pre><p>This is equivalant to</p><pre><code>print(Knead(&quot;cities.csv&quot;).data())</code></pre><p>You can also specify the input and output formats, when those are not available in the file extension, or if you want to overwrite them. This is useful in combination with the <code>--stdin</code> option, which allows you to take data from stdin and directly transform output from a HTTP API to something else.</p><p>For example, this API request gives you back a JSON summary of the article for Amsterdam on the English Wikipedia.</p><pre><code>curl https://en.wikipedia.org/api/rest_v1/page/summary/Amsterdam</code></pre><p>Piping that into dataknead using --stdin and -if json gives you a nicely formatted file</p><pre><code>curl https://en.wikipedia.org/api/rest_v1/page/summary/Amsterdam | knead --stdin -if json</code></pre><h2 id="api">API</h2><h3 id="class-datakneadkneadinp-parse_as--none-read_as--none-is_data--false"><em>class</em> <code>dataknead.Knead(</code><em>inp, parse_as = None, read_as = None, is_data = False</em><code>)</code></h3><p>If <code>inp</code> is a string, a filepath is implied and the extension is used to get the correct loader.</p><pre><code class="language-python">Knead(&quot;cities.csv&quot;)</code></pre><p>To overwrite this behaviour (for a file that doesn&#39;t have the correct extension), use the <code>read_as</code> argument.</p><pre><code class="language-python">Knead(&quot;cities&quot;, read_as=&quot;csv&quot;)</code></pre><p>If <code>inp</code> is not a string, data is implied.</p><pre><code class="language-python">Knead([1,2,3])</code></pre><p>To force a string to be used as data instead of a file path, set <code>is_data</code> to <code>True</code>.</p><pre><code class="language-python">Knead(&quot;http://www.github.com&quot;, is_data = True)</code></pre><p>To force parsing of a string to data (e.g., from a JSON HTTP request), set <code>parse_as</code> to the correct format.</p><pre><code class="language-python">Knead(&#39;{&quot;error&quot; : 404}&#39;, parse_as=&quot;json&quot;)</code></pre><p>Some loaders might come with extra arguments. E.g. the <code>csv</code> loader has an option to force using a header, if it isn&#39;t detected automatically</p><pre><code class="language-python">Knead(&quot;cities.csv&quot;, has_header = True)</code></pre><h3 id="add_loaderloader"><code>add_loader(*loader*)</code></h3><p>Add a new loader to the <code>Knead</code> instance. Read the section on <a href="#extending-dataknead">extending dataknead</a> on how to write your own loader.</p><pre><code class="language-python">Knead.add_loader(YamlLoader)</code></pre><h3 id="applyfn"><code>apply(</code><em>fn</em><code>)</code></h3><p>Runs all data through a function.</p><pre><code class="language-python">print(Knead([&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]).apply(lambda x:&quot;&quot;.join(x))) # &#39;abc&#39;</code></pre><h3 id="datacheck_instance--none"><code>data(</code><em>check_instance = None</em><code>)</code></h3><p>Returns the parsed data.</p><pre><code class="language-python">data = Knead(&quot;cities.csv&quot;).data()</code></pre><p>To raise an exception for an invalid instance, pass that to <code>check_instance</code>.</p><pre><code class="language-python">data = Knead(&quot;cities.csv&quot;).data(check_instance = dict)</code></pre><h3 id="filterfn"><code>filter(</code><em>fn</em><code>)</code></h3><p>Run a function over the data and only keep the elements that return <code>True</code> in that functon.</p><pre><code class="language-python">Knead(&quot;cities.csv&quot;).filter(lambda city:city[&quot;country&quot;] == &quot;it&quot;).write(&quot;cities-italy.csv&quot;)

&quot;&quot;&quot;Or do this&quot;&quot;&quot;
def is_italian(city):
    return city[&quot;country&quot;]  == &quot;it&quot;

Knead(&quot;cities.csv&quot;).filter(is_italian).write(&quot;cities-italy.csv&quot;)</code></pre><h3 id="keys"><code>keys()</code></h3><p>Returns the keys of the data.</p><h3 id="mapfn--str--tuple"><code>map(</code><em>fn</em> | <em>str</em> | <em>tuple</em><code>)</code></h3><p>Run a function over all elements in the data.</p><pre><code class="language-python">Knead(&quot;cities.csv&quot;).map(lambda city:city[&quot;city&quot;].upper()).write(&quot;cities-uppercased.json&quot;)</code></pre><p>To return one key in every item, you can pass a string as a shortcut:</p><pre><code class="language-python">Knead(&quot;cities.csv&quot;).map(&quot;city&quot;).write(&quot;city-names.csv&quot;)

&quot;&quot;&quot;Is the same as&quot;&quot;&quot;

Knead(&quot;cities.csv&quot;).map(lambda c:c[&quot;city&quot;]).write(&quot;city-names.csv&quot;)</code></pre><p>To return multiple keys with values, you can use a tuple:</p><pre><code class="language-python">Knead(&quot;cities.csv&quot;).map((&quot;city&quot;, &quot;country&quot;)).write(&quot;city-country-names.csv&quot;)

&quot;&quot;&quot;Is the same as&quot;&quot;&quot;

Knead(&quot;cities.csv&quot;).map(lambda c:{ &quot;city&quot; : c[&quot;city&quot;], &quot;country&quot; : c[&quot;country&quot;] }).write(&quot;city-country-names.csv&quot;)

&quot;&quot;&quot;Or&quot;&quot;&quot;

def mapcity(city):
    return {
        &quot;city&quot; : city[&quot;city&quot;],
        &quot;country&quot; : city[&quot;country&quot;]
    }

Knead(&quot;cities.csv&quot;).map(mapcity).write(&quot;city-country-names.csv&quot;)
</code></pre><h3 id="values"><code>values()</code></h3><p>Returns values of the data.</p><h3 id="writepath-write_as--none"><code>write(</code><em>path, write_as = None</em><code>)</code></h3><p>Writes the data to a file. Type is implied by file extension.</p><pre><code class="language-python">Knead(&quot;cities.csv&quot;).write(&quot;cities.json&quot;)</code></pre><p>To force the type to something else, pass the format to <code>write_as</code>.</p><pre><code class="language-python">Knead(&quot;cities.csv&quot;).map(&quot;city&quot;).write(&quot;cities.txt&quot;, write_as=&quot;csv&quot;)</code></pre><p>Some of the loaders have extra options you can pass to <code>write</code>:</p><pre><code class="language-Python">Knead(&quot;cities.csv&quot;).write(&quot;cities.json&quot;, indent = 4)
Knead(&quot;cities.csv&quot;).map(&quot;city&quot;).write(&quot;ciites.csv&quot;, fieldnames=[&quot;city&quot;])</code></pre><h2 id="extending-dataknead">Extending dataknead</h2><p>You can write your own loaders to read and write other formats than the default ones. For an example take a look at the <a href="https://github.com/hay/dataknead/blob/master/tests/yaml_example.py">YAML example</a>.</p><h2 id="remarks">Remarks</h2><ul> <li>Note that <code>dataknead</code> is Python 3-only.</li> </ul><h2 id="credits">Credits</h2><p>Written by <a href="https://www.haykranen.nl">Hay Kranen</a>.</p><h2 id="license">License</h2><p>Licensed under the <a href="https://opensource.org/licenses/MIT">MIT license</a>.</p><h2 id="development-information">Development information</h2><p>If you want to work on <code>dataknead</code> follow these steps</p><p>Clone the repo</p><pre><code>git clone https://github.com/hay/dataknead</code></pre><p>And use <a href="https://python-poetry.org/">Poetry</a> to install dependencies</p><pre><code>poetry install</code></pre><p>Or alternatively</p><pre><code>pip install pandas pyyaml xlrd xlwt xmltodict</code></pre><p>You might need to install a couple of dependencies beforehand</p><pre><code>pip install wheel</code></pre><p>And (depending on your OS) some other deps too. For Debian / Ubuntu try</p><pre><code>apt install build-essential autoconf libtool automake</code></pre><h2 id="release-history">Release history</h2><h3 id="04">0.4</h3><ul> <li>Upgraded some dependencies, including Pandas to &gt;1.1. <code>dataknead</code> now requires Python 3.6.1 or higher.</li> <li>Added a TOML loader.</li> </ul><h3 id="03">0.3</h3><ul> <li>Breaking change: removed the <code>query</code> method: the focus of <code>dataknead</code> is on conversion. Using <code>apply</code> you can easily use a tool like <code>jq</code> to query.</li> </ul><h3 id="02">0.2</h3><ul> <li>Adding tuple shortcut to <code>map</code> (#2)</li> <li>Adding support for <code>txt</code> files ((#4)</li> <li>Adding support for loader constructor argument passing, and adding a <code>has_header</code> option to <code>CsvLoader</code> (#5)</li> </ul><h3 id="01">0.1</h3><p>Initial release</p>